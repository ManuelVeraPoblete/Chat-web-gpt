<div class="sidebar-card">
  <div class="sidebar-header">
    <div class="title">Chats</div>

    <button mat-button class="refresh" (click)="vm.load()">
      <mat-icon>refresh</mat-icon>
      Actualizar
    </button>
  </div>

  <mat-tab-group
    class="tabs"
    animationDuration="0ms"
    (selectedIndexChange)="onTabIndexChange($event)"
  >
    <!-- TAB: Usuarios (sin IA) -->
    <mat-tab label="Usuarios">
      <div class="status-legend">
        <div class="item"><span class="dot green"></span>Conectado</div>
        <div class="item"><span class="dot yellow"></span>Pausa</div>
        <div class="item"><span class="dot orange"></span>Almuerzo</div>
        <div class="item"><span class="dot gray"></span>Desconectado</div>
      </div>

      <div class="loading" *ngIf="vm.loading()">
        <mat-spinner diameter="26"></mat-spinner>
        <span>Cargando usuarios…</span>
      </div>

      <mat-nav-list *ngIf="!vm.loading()">
        <a
          mat-list-item
          class="user-row"
          *ngFor="let u of usersFiltered(); trackBy: trackById"
          (click)="selectUser(u)"
          [class.selected]="isSelected(u)"
        >
          <mat-icon matListItemIcon class="avatar-ic">account_circle</mat-icon>

          <div matListItemTitle class="name">
            {{ u.displayName }}
          </div>

          <div matListItemLine class="meta" *ngIf="u.jobTitle || u.companySection">
            {{ u.jobTitle || '' }}
            <span *ngIf="u.jobTitle && u.companySection">•</span>
            {{ u.companySection || '' }}
          </div>

          <span
            class="unread"
            *ngIf="unreadCount(u) > 0"
            [matBadge]="unreadCount(u)"
            matBadgeColor="warn"
            matBadgeSize="small"
            matBadgeOverlap="false"
          ></span>
        </a>
      </mat-nav-list>
    </mat-tab>

    <!-- TAB: Chat IA (muestra SOLO el asistente como “usuario”) -->
<mat-tab label="Chat IA">
  <div class="loading" *ngIf="vm.loading()">
    <mat-spinner diameter="26"></mat-spinner>
    <span>Cargando…</span>
  </div>

  <div class="placeholder" *ngIf="!vm.loading() && !assistantUser()">
    <mat-icon>warning</mat-icon>
    <p>Configura <strong>assistantUserId</strong> en environment para ver el Asistente IA.</p>
  </div>

  <mat-nav-list *ngIf="!vm.loading() && assistantUser() as a">
    <a
      mat-list-item
      class="user-row ai-row"
      (click)="openAssistant()"
      aria-label="Abrir chat con Asistente IA"
      matBadge="IA"
      matBadgeColor="primary"
      matBadgePosition="after"
      matBadgeSize="medium"
      matBadgeOverlap="false"
    >
      <mat-icon matListItemIcon class="avatar-ic ai-ic">smart_toy</mat-icon>

      <div matListItemTitle class="name">
        {{ a.displayName || 'Asistente IA' }}
      </div>

      <div matListItemLine class="meta ai-meta">
        <span class="online-dot" aria-hidden="true"></span>
        Online • {{ a.jobTitle || 'Asistente Corporativo' }}
      </div>
    </a>
  </mat-nav-list>
</mat-tab>

  </mat-tab-group>
</div>
